<?php

use Dotenv\Dotenv;

require __DIR__ . '/vendor/autoload.php';

$dotenv = Dotenv::createImmutable(__DIR__);
$dotenv->load();

$serverPath = __DIR__ . '/src/Server.php';
$clientPath = __DIR__ . '/src/Client.php';

function isListening()
{
    return empty(exec('netstat -an | grep ' . $_ENV['TCP_ADDRESS_PORT']));
}

if (! isListening()) {
    exec('php ' . __DIR__ . $serverPath . ' > /dev/null 2>&1 &');
}

exec('php ' . __DIR__ . $clientPath);